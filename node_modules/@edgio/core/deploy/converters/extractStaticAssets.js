"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.extractStaticAssets = void 0;
const extractDestination_1 = require("./extractDestination");
const pathToGlobby_1 = __importDefault(require("../../utils/pathToGlobby"));
const RulesVisitor_1 = __importDefault(require("../../runtime/rules/RulesVisitor"));
/**
 * Extracts all static assets from the router on rules that are url rewrites
 * (it assumes it's a rewrite), and it will return StaticAssetEntry array if
 * any are found.
 */
const extractStaticAssets = (rules) => {
    // Now add static assets from the router, we need to find all rewrites that
    // have a destination and set_origin to static origin then add
    // the destination to the static asset bundle
    let globs = [];
    new RulesVisitor_1.default({
        onFeaturesVisit: (features) => {
            globs.push(...(0, extractDestination_1.extractDestination)(features).map(d => ({
                glob: [(0, pathToGlobby_1.default)(d.destination)],
                permanent: d.permanent,
            })));
        },
    }).visit(rules);
    return globs;
};
exports.extractStaticAssets = extractStaticAssets;
