"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.extractDestination = void 0;
const origins_1 = require("../../origins");
const removeLeadingSlash = (destination) => {
    return destination.startsWith('/') ? destination.substring(1) : destination;
};
const removeOptionalPart = (destination) => {
    return destination.replace(/:optionalQuery$/, '').replace(/:optionalSlash$/, '');
};
/**
 * Extracts the destination from features.
 * We're assuming that every rule that has origin set to static (or permanent static) and has url_rewrite,
 * is created by serveStatic routeHelper. In this case we will return the object with destination and permanent info about origin.
 * Otherwise, we will return empty array.
 */
const extractDestination = (features) => {
    var _a, _b, _c, _d;
    const originName = (_a = features === null || features === void 0 ? void 0 : features.origin) === null || _a === void 0 ? void 0 : _a.set_origin;
    let destinations = [];
    if (originName !== origins_1.STATIC_ORIGIN_NAME && originName !== origins_1.PERMANENT_STATIC_ORIGIN_NAME)
        return [];
    const rewriteDestinations = (_d = (_c = (_b = features.url) === null || _b === void 0 ? void 0 : _b.url_rewrite) === null || _c === void 0 ? void 0 : _c.flatMap(p => p.destination).filter(p => p !== undefined)) !== null && _d !== void 0 ? _d : [];
    rewriteDestinations.forEach(destination => destinations.push({
        destination: removeLeadingSlash(removeOptionalPart(destination)),
        permanent: originName === origins_1.PERMANENT_STATIC_ORIGIN_NAME,
    }));
    return destinations;
};
exports.extractDestination = extractDestination;
