"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const log_1 = __importDefault(require("../log"));
const EarlyReturn_1 = __importDefault(require("./EarlyReturn"));
const HandlerFinished_1 = __importDefault(require("./HandlerFinished"));
const Phase_1 = __importDefault(require("./Phase"));
async function executePlan(plan) {
    try {
        for (let step of plan) {
            try {
                for (let mod of step.modules) {
                    const start = new Date().getTime();
                    try {
                        await mod.execute(step.phase);
                    }
                    finally {
                        log_1.default.trace(`executed ${Phase_1.default[step.phase]}: ${mod.constructor.name} in ${new Date().getTime() - start}ms`);
                    }
                }
            }
            catch (e) {
                if (!(e instanceof HandlerFinished_1.default)) {
                    throw e;
                }
            }
        }
    }
    catch (e) {
        if (!(e instanceof EarlyReturn_1.default)) {
            throw e;
        }
    }
}
exports.default = executePlan;
