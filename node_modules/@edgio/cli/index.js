#!/usr/bin/env node
'use strict';

// Launch CLI with the new --max-http-header-size option. The size is set to 64kb
// which is the same size we use in XBP. We cannot use the option directly on the bangs
// as not all operating systems/shells support that.
const spawn = require('cross-spawn');
const join = require('path').join;
const args = process.argv.slice(2);
let entry = 'cli-local.js';

// While running "0 curl" we need to run a separate instance of yargs command parser.
// This is because we don't care about the context provided to cli deploy commands and we need
// to allow extra command arguments. There might be a better way for that, but this should work fine.
if (args[0] === 'curl') {
  entry = 'curl/index.js';
}

// We have to spawn the node with additional arguments while keeping the user provided arguments.
const child = spawn('node', ['--max-http-header-size=65536', join(__dirname, entry)].concat(args), {
  stdio: 'inherit'
});
// We need the error level of the main process reflect the actual result of the command.
child.on('close', code => process.exit(code));