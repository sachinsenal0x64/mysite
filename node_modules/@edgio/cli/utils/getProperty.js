"use strict";

module.exports = async function getProperty(context, propertySlug, organizationSlug = null) {
  var _await$context$api$ge;
  // Get personal organization slug if no organizationSlug is provided
  organizationSlug = organizationSlug ?? ((_await$context$api$ge = await context.api.getPersonalOrganization()) === null || _await$context$api$ge === void 0 ? void 0 : _await$context$api$ge.slug);
  const organizations = await context.api.getOrganizationsPropertiesEnvs();
  if (!organizations || organizations.nodes.length === 0) {
    context.logger.error(`Error: Couldn't fetch the organizations.`);
    process.exit(1);
  }
  const organization = organizations.nodes.find(organization => organization.slug === organizationSlug);
  if (!organization) {
    context.logger.error(`Error: Couldn't find organization ${organizationSlug}`);
    process.exit(1);
  }
  const properties = organization.properties.nodes;
  const selectedProperty = properties.find(property => property.slug === propertySlug);
  if (!selectedProperty) {
    context.logger.error(`Error: Property with this name was not found in organization ${organizationSlug}.`);
    process.exit(1);
  }
  return selectedProperty;
};