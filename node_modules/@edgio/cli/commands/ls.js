"use strict";

const authenticate = require('../prompts/authenticate');
const chalk = require('chalk');
exports.command = 'ls';
exports.describe = 'Lists all organizations, properties and environments';
exports.builder = {};
exports.handler = async ({
  context
}) => {
  const {
    analytics
  } = context;
  const promisedTracked = analytics.trackEvent('ls');
  await authenticate(context);
  const data = await context.api.getOrganizationsPropertiesEnvs();
  const colorizedOutput = (color, name, info) => `${chalk.bold.keyword(color)(name)} (${chalk.dim.white(info)})`;
  data.nodes.forEach(organization => {
    console.log(colorizedOutput('aqua', organization.slug, 'organization'));
    organization.properties.nodes.forEach(property => {
      console.log(`   ${colorizedOutput('lime', property.slug, 'property')}`);
      property.environments.nodes.forEach(env => console.log(`      ${colorizedOutput('orange', env.name, 'environment')}`));
    });
  });
  await promisedTracked;
};