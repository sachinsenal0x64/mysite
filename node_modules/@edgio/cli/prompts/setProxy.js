"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
/**
 * When user specify CLI_PROXY_URL env variable or --proxy-url argument,
 * we will use it as a proxy server for all requests made by CLI.
 *
 * This is useful for users who are behind a corporate proxy.
 *
 * Syntax is: export CLI_PROXY_URL=https:<username>:<password>@proxy-server.com:8443
 * Optional parts are username, password and port.
 *
 * @example export CLI_PROXY_URL=http://proxy.company:8080
 */
const setProxy = ({
  context
}) => {
  const {
    logger,
    proxyUrl
  } = context;

  // Axios will automatically parse and use https_proxy and http_proxy
  // env variables by default and replace optional parts with default values.
  process.env['http_proxy'] = process.env['https_proxy'] = proxyUrl || '';
  if (!proxyUrl) {
    return;
  }

  // Hide username and password in proxy URL,
  // so it's not visible in logs and with every command.
  const proxyUrlRedacted = proxyUrl.replace(/:\/\/.*:.*@/, '://***:***@');

  // Indicate that we are using proxy, so user is aware of it
  // when global env variable is set.
  logger.success(`üåê Using proxy "${proxyUrlRedacted}"`);
};
var _default = setProxy;
exports.default = _default;
module.exports = exports.default;